<?php
$jsonData = $block->getJsonTemplateData();
?>
<div class="size-chart-container">
    <div id="size-chart-preview-container" style="margin-top: 20px; display: flex; justify-content: center;">
        <div id="preview-content" style="max-width: 600px;"></div>
    </div>
</div>

<script>
require(['jquery', 'uiRegistry'], function ($, registry) {
    var templateData = <?= $jsonData ?>;

    // Wait for UI component field to be initialized
    setTimeout(function() {
        // Get the UI component select field
        var selectField = registry.get('product_form.product_form.size_chart_section.size_chart_template_id');
        
        if (selectField) {
            // Listen for changes on the UI component field
            selectField.on('value', function(value) {
                if (value && templateData[value]) {
                    $('#preview-content').html(templateData[value]);
                } else {
                    $('#preview-content').html('');
                }
            });
            
            // Initialize preview if value already exists
            var currentValue = selectField.value();
            if (currentValue && templateData[currentValue]) {
                $('#preview-content').html(templateData[currentValue]);
            }
        } else {
            // Fallback: Try to find the select element directly
            setTimeout(function() {
                var selectElement = $('select[name*="size_chart_template_id"]');
                if (selectElement.length > 0) {
                    selectElement.on('change', function() {
                        var id = $(this).val();
                        $('#preview-content').html(templateData[id] || '');
                    });
                    
                    // Initialize preview
                    var initialValue = selectElement.val();
                    if (initialValue && templateData[initialValue]) {
                        $('#preview-content').html(templateData[initialValue]);
                    }
                }
            }, 1000);
        }
    }, 1000);
});
</script>


<style>
    #preview-content table { width: 100%; border-collapse: collapse; }
    #preview-content th { background: #514943; color: white; padding: 10px; text-transform: uppercase; }
    #preview-content td { padding: 10px; border: 1px solid #ddd; text-align: center; }
    #preview-content tr:nth-child(even) { background: #f9f9f9; }
</style>